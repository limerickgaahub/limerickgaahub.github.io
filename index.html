<!doctype html> 
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Limerick GAA Hub</title>
<meta name="color-scheme" content="light only">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BW8JCZRZHV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BW8JCZRZHV');
  </script>

<link rel="canonical" href="https://limerickgaahub.ie/">
  
<!-- Meta description -->
<meta name="description" content="Fixtures, results and tables for Limerick GAA. Filter by competition, team, or date.">

<!-- Open Graph (Facebook, WhatsApp, LinkedIn) -->
<meta property="og:title" content="Limerick GAA Hub">
<meta property="og:description" content="Fixtures, results and tables for Limerick GAA. Filter by competition, team, or date.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://limerickgaahub.ie/">
<meta property="og:image" content="https://limerickgaahub.ie/android-chrome-512x512.png">

<!-- X / Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Limerick GAA Hub">
<meta name="twitter:description" content="Fixtures, results and tables for Limerick GAA. Filter by competition, team, or date.">
<meta name="twitter:image" content="https://limerickgaahub.ie/android-chrome-512x512.png">
<meta name="twitter:site" content="@limerickgaahub">

<meta property="og:image:alt" content="Limerick GAA Hub logo">

<meta name="robots" content="index,follow">

<!-- Favicons & app icons -->
<!-- SVG (modern browsers) -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml">

<!-- Classic PNG favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">

<!-- ICO fallback -->
<link rel="shortcut icon" href="/favicon.ico">

<!-- Apple Touch -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<meta name="apple-mobile-web-app-title" content="Limerick GAA Hub">

<!-- Android / PWA -->
<link rel="manifest" href="/site.webmanifest">

<!-- Font Awesome -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">


<link rel="stylesheet" href="/css/app.css?v=7_3_3_fix12">

<script>
  // Capture ?share=1 early before syncURL() strips it
  window.__LGH_SHARE_ENABLED =
    (new URLSearchParams(location.search).get('share') === '1');

  // Load Share Card CSS + html2canvas only when share mode is enabled
  if (window.__LGH_SHARE_ENABLED) {
    const l = document.createElement('link');
    l.rel = 'stylesheet';
    l.href = '/css/sharecard.css?v=7_3_3_fix12';
    document.head.appendChild(l);

    window.__LGH_H2C_READY = false;

  const s = document.createElement('script');
  s.src = 'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js';
  s.onload = () => { window.__LGH_H2C_READY = true; };
  s.onerror = () => { window.__LGH_H2C_READY = false; };
  document.head.appendChild(s);
  }
</script>

</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-inner">
      <a href="/" class="brand">
        <img src="/favicon-32x32.png" alt="Logo">
        <h1>Limerick GAA Hub</h1>
      </a>
      <div class="navtabs">
        <div class="navtab active" data-nav="hurling">Hurling</div>
        <div class="navtab" data-nav="football">Football</div>
        <div class="navtab" data-nav="about">About</div>
      </div>
      <button class="burger" id="burger" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>
    </div>
  </div>
  <div class="oc-backdrop" id="oc-backdrop"></div>
  <div class="offcanvas" id="offcanvas" aria-hidden="true">
    <div class="oc-head">Menu</div>
    <div class="oc-body">
      <div class="oc-link" data-nav="hurling">Hurling</div>
      <div class="oc-link" data-nav="football">Football</div>
      <div class="oc-link" data-nav="about">About</div>
    </div>
  </div>

    <!-- Mobile sport selector (single pill) -->
  <div class="sportbar card" id="sportbar">
    <button class="sportpill" id="sportpill" type="button" aria-haspopup="menu" aria-expanded="false">
      <span id="sportpill-label">Hurling</span>
      <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
    </button>
  </div>
  <div class="menu" id="sport-menu" role="menu" aria-hidden="true">
    <div class="item" data-sport="hurling">Hurling</div>
    <div class="item" data-sport="football">Football</div>
  </div>


  <!-- Hurling -->
  <div id="panel-hurling" class="card">
    <div class="section-tabs view-tabs" id="view-tabs">
      <div class="seg vt active" data-target="group-panel" id="comp-tab">Competition</div>
      <div class="seg vt" data-target="by-team">Club</div>
      <div class="seg vt" data-target="by-date">Date</div>
    </div>
    <div class="menu" id="comp-menu" role="menu" aria-hidden="true"></div>

    <div class="panel card" id="group-panel" style="margin-top:6px;">
        <div id="comp-list" class="comp-list" style="display:none;"></div>
        <div class="comp-selected" id="comp-selected" aria-live="polite"></div>

    <div class="section-tabs">
      <div class="seg active" data-view="matches" id="matches-seg">
        <span id="matches-label">Matches</span>
        <i class="fa-solid fa-chevron-down" id="matches-chevron" style="font-size:12px; margin-left:6px;"></i>
      </div>
      <div class="seg" data-view="table">Table</div>
    </div>
    <!-- New: Matches dropdown menu -->
    <div class="menu" id="matches-menu" role="menu" aria-hidden="true"></div>

      <div class="controls card" id="controls-matches">
  <label for="status" class="sr-only">Show</label>
  <div class="pretty-select">
    <select id="status">
      <option value="">All (fixtures & results)</option>
      <option value="Result">Results only</option>
      <option value="Fixture">Fixtures only</option>
    </select>
  </div>
</div>


    
      <div class="table-wrap matches-wrap">
        <table id="g-table"><thead></thead><tbody></tbody></table>
      </div>

      <div id="g-standings" style="margin-top:12px; display:none;">
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-bottom:8px;">
          <button class="iconbtn" id="btn-expand"><i class="fa-solid fa-up-right-and-down-left-from-center"></i> Expand</button>
        </div>
        <div class="table-wrap">
        <table id="g-standings-table">
          <colgroup>
            <col style="width:44%">
            <col style="width:6%"><col style="width:6%"><col style="width:6%"><col style="width:6%">
            <col style="width:8%"><col style="width:8%"><col style="width:8%"><col style="width:8%">
          </colgroup>
          <thead>
            <tr>
              <th>Team</th>
              <th class="right">P</th>
              <th class="right">W</th>
              <th class="right">D</th>
              <th class="right">L</th>
              <th class="right">Pts</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        </div>
      </div>

      <!-- Table footnote -->
      <div id="table-footnote" class="footnote" style="display:none;">
        Tie-breaks: Qualification: Head-to-Head (two teams only), then Points Difference, Points For, Goals For. Relegation: Playoff if two teams on equal points.
      </div>

      <!-- Share (Competition) -->
      <div class="sharebar" id="sharebar-comp">
        <button class="iconbtn" data-role="copy"><i class="fa-solid fa-link"></i> Copy link</button>
        <button class="iconbtn" data-role="share"><i class="fa-solid fa-share"></i> Share</button>
        <div class="spacer"></div>
      </div> 
    </div>

      <div class="panel card" id="by-team" style="display:none; margin-top:6px;">
        <h2>By Club</h2>
        <div class="controls card" id="controls-team">
          <label for="team" class="sr-only">Select club</label>
        <div class="pretty-select">
          <select id="team"><option value="">Select club…</option></select>
    </div>
  </div>

      
        <div class="table-wrap"><table id="team-table"><thead></thead><tbody></tbody></table></div>
      
        <!-- Share (Team) -->
        <div class="sharebar" id="sharebar-team">
          <button class="iconbtn" data-role="copy"><i class="fa-solid fa-link"></i> Copy link</button>
          <button class="iconbtn" data-role="share"><i class="fa-solid fa-share"></i> Share</button>
          <div class="spacer"></div>
        </div>
      </div>


        <!-- Share (Date) — inside the panel -->
            <div class="panel card" id="by-date" style="display:none; margin-top:6px;">
              <h2>By Date</h2>
              <div id="controls-date" class="controls card">
                <label class="sr-only" for="date-input">Select date</label>
                <div class="pretty-input">
                  <input id="date-input" type="date" />
                  <!-- Mobile chevron tap target -->
                  <button type="button" class="date-open" aria-label="Open calendar"></button>
                </div>
              </div>

            
              <div class="table-wrap"><table id="date-table"><thead></thead><tbody></tbody></table></div>

            <!-- Back to Top button (only shows when Date tab active) -->
            <button class="scroll-top-btn" id="scroll-top-btn" aria-label="Back to top">
              <i class="fa-solid fa-arrow-up"></i>
            </button>

            
              
              <!-- Share (Date) -->
              <div class="sharebar" id="sharebar-date">
                <button class="iconbtn" data-role="copy"><i class="fa-solid fa-link"></i> Copy link</button>
                <button class="iconbtn" data-role="share"><i class="fa-solid fa-share"></i> Share</button>
                <div class="spacer"></div>
              </div>
            </div>
      </div>    <!-- end of #panel-hurling -->


  
      
  <!-- Football -->
  <div id="panel-football" class="card" style="display:none;">
    <h2>Football</h2>
    <div class="sm-muted">Coming soon.</div>
  </div>

  <!-- About -->
  <div id="panel-about" class="card" style="display:none;">
      <p>Limerick GAA Hub is designed to provide a clear overview of fixtures and results, easily filterable by competition, club, or date.</p>
      <p>The aim is to additionally build an archive of historical results over time.</p>
      <p>This site is not associated with Limerick GAA. Official fixtures and results can still be found at 
        <a href="https://limerickgaa.ie" target="_blank" rel="noopener noreferrer">limerickgaa.ie</a>.
      </p>
    
      <div class="social-list" aria-label="Social links">
        <a class="social-link" href="https://www.instagram.com/limerickgaahub" target="_blank" rel="noopener noreferrer"
           aria-label="Visit Limerick GAA Hub on Instagram">
           <i class="fab fa-instagram"></i><span>@limerickgaahub</span>
        </a>
        <a class="social-link" href="https://x.com/limerickgaahub" target="_blank" rel="noopener noreferrer"
           aria-label="Visit Limerick GAA Hub on X (Twitter)">
           <i class="fa-brands fa-x-twitter"></i><span>@limerickgaahub</span>
        </a>
        <a class="social-link" href="mailto:limerickgaahub@gmail.com"
           aria-label="Email Limerick GAA Hub">
           <i class="fas fa-envelope"></i><span>limerickgaahub@gmail.com</span>
        </a>
      </div>

      <p style="font-size: 12px; color: #6b7280; margin-top: 15px;">
        Privacy: This site uses Google Analytics to collect anonymous visitor statistics. 
        No personal data is collected or shared.
      </p>     
</div> <!-- end of #panel-about -->

  <!-- Expand modal -->
<div class="modal" id="standings-modal" aria-hidden="true" inert>
  <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
    <div class="sheet-header">
      <h3 id="modal-title">Table</h3>
      <button class="close" id="modal-close">Close</button>
    </div>
    <div class="table-wrap">
      <table id="modal-standings">
      <colgroup>
        <col style="width:44%">
        <col style="width:6%">
        <col style="width:6%">
        <col style="width:6%">
        <col style="width:6%">
        <col style="width:8%">
        <col style="width:8%">
        <col style="width:8%">
        <col style="width:8%">
      </colgroup>
      <thead>

          <tr>
            <th>Team</th><th class="right">P</th><th class="right">W</th>
            <th class="right">D</th><th class="right">L</th>
            <th class="right">PF</th><th class="right">PA</th>
            <th class="right">PD</th><th class="right">Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>


  <footer class="site-footer">Limerick GAA Hub · 2025</footer>

  <!-- JS -->
  <script src="/js/app_v7_3_3.fix12.js" defer></script>
  <script>
    // Inline logger to confirm flags at load
    window.addEventListener('load', () => {
      console.log("[LGH] onload flags:",
        "LGH_V7_3_READY =", window.LGH_V7_3_READY,
        "LGH_V7_3_3_READY =", window.LGH_V7_3_3_READY
      );
    });

    // Burger
    (function(){
      const burger=document.getElementById('burger'), oc=document.getElementById('offcanvas'), bd=document.getElementById('oc-backdrop');
      const open=()=>{ oc.classList.add('open'); bd.classList.add('show'); oc.setAttribute('aria-hidden','false'); };
      const close=()=>{ oc.classList.remove('open'); bd.classList.remove('show'); oc.setAttribute('aria-hidden','true'); };
      burger.addEventListener('click', open);
      bd.addEventListener('click', close);
      oc.addEventListener('click', e=>{
        const link=e.target.closest('.oc-link');
        if(link){
          const tab=document.querySelector(`.navtab[data-nav="${link.dataset.nav}"]`);
          if(tab) tab.click();
          close();
        }
      });
    })();

    function closeCompMenu(){
      const menu=document.getElementById('comp-menu');
      if(menu){ menu.classList.remove('open'); menu.setAttribute('aria-hidden','true'); }
    }


    // View tab switching closes dropdown
    document.querySelectorAll('.view-tabs .vt').forEach(seg=>{
      seg.addEventListener('click', ()=>{
        if(seg.dataset.target!=='group-panel'){ closeCompMenu(); }
      });
    });
    document.querySelectorAll('.navtab').forEach(tab=>{
      tab.addEventListener('click', ()=>{ closeCompMenu(); });
    });

    // Also hide matches-only controls when leaving the Competition view
      document.querySelectorAll('.view-tabs .vt').forEach(seg=>{
        seg.addEventListener('click', ()=>{
          const inGroup = seg.dataset.target === 'group-panel';
          const mc = document.getElementById('controls-matches');
          if (mc) mc.style.display = inGroup ? '' : 'none';
        });
      });


    
    // Back button

    // Brand click = reset to Hurling Competition
    document.querySelector('.brand').addEventListener('click', e=>{
      e.preventDefault();
      document.querySelector('.navtab[data-nav="hurling"]').click();
      document.querySelector('#view-tabs .vt[data-target="group-panel"]').click();
    });

    // Warn if app didn't init (tolerant)
    window.addEventListener('load', () => {
      setTimeout(() => {
        const ok = (window.LGH_V7_3_3_READY === true) || (window.LGH_V7_3_READY === true);
        if (!ok) {
          const warnEl = document.getElementById('lgh-warning');
          if (warnEl) warnEl.style.display = 'block';
          console.error("[LGH] Warning shown: READY flags not true at load.");
        } else {
          console.log("[LGH] App ready; warning suppressed.");
        }
        // Ensure default view on first load
        document.getElementById('g-standings').style.display = 'none';
        document.querySelector('.matches-wrap').style.display = '';
      }, 50);
    });

    // Blur selects on Android to close pickers
    (function(){
      ['team','status','date-input'].forEach(id=>{
        const el=document.getElementById(id);
        if(el){ el.addEventListener('change',()=>el.blur()); }
      });
    })();

    // Sharebar wiring
    (function(){
      function getContext(){
        const activeCompSeg = document.querySelector('#group-panel .section-tabs .seg.active');
        const compView = activeCompSeg ? activeCompSeg.getAttribute('data-view') : 'matches';
        const compName = (document.getElementById('comp-selected')?.textContent || '').trim() || 'Competition';
        const statusSel = document.getElementById('status');
        const statusText = statusSel ? statusSel.options[statusSel.selectedIndex].text : 'All (fixtures & results)';

        const teamSel = document.getElementById('team');
        const teamText = teamSel ? teamSel.options[teamSel.selectedIndex]?.text || '' : '';

        const dateSel  = document.getElementById('date-input');
        const dateText = dateSel && dateSel.value ? dateSel.value : '';

        const teamVisible = getComputedStyle(document.getElementById('by-team')).display !== 'none';
        const dateVisible = getComputedStyle(document.getElementById('by-date')).display !== 'none';

        if (teamVisible && teamText) return { msg: `Limerick GAA Hub — ${teamText} (${statusText})` };
        if (dateVisible) {
         const niceDate = dateText
           ? new Date(dateText + 'T00:00:00').toLocaleDateString(undefined, { weekday:'short', year:'numeric', month:'short', day:'numeric' })
           : 'Selected date';
         return { msg: `Limerick GAA Hub — By date: ${niceDate} (${statusText})` };
      }
        const viewLabel = compView === 'table' ? 'Table' : 'Matches';
        return { msg: `Limerick GAA Hub — ${compName}: ${viewLabel} (${statusText})` };
      }

function updateSharebars(){
  const { msg } = getContext();
  const url = location.href;

  // Share intents
  const xIntent  = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(msg) + '&url=' + encodeURIComponent(url);
  const fbIntent = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url);
  const waIntent = 'https://wa.me/?text=' + encodeURIComponent(msg + ' ' + url);
  const mailto   = 'mailto:?subject=' + encodeURIComponent('Limerick GAA Hub') +
                   '&body=' + encodeURIComponent(msg + '\n\n' + url);

  ['sharebar-comp','sharebar-team','sharebar-date'].forEach(id=>{
    const bar = document.getElementById(id);
    if (!bar) return;

    const btnX     = bar.querySelector('[data-role="x"]');
    const btnFB    = bar.querySelector('[data-role="fb"]');
    const btnWA    = bar.querySelector('[data-role="wa"]');
    const btnEmail = bar.querySelector('[data-role="email"]');
    const btnCopy  = bar.querySelector('[data-role="copy"]');
    const btnShare = bar.querySelector('[data-role="share"]');

    if (btnX)     btnX.href    = xIntent;
    if (btnFB)    btnFB.href   = fbIntent;
    if (btnWA)    btnWA.href   = waIntent;
    if (btnEmail) btnEmail.href= mailto;

    if (btnCopy) {
      btnCopy.onclick = async () => {
        try {
          await navigator.clipboard.writeText(url);
          btnCopy.textContent = 'Link copied!';
          setTimeout(()=> btnCopy.innerHTML = '<i class="fa-solid fa-link"></i> Copy link', 1200);
        } catch {
          const t = document.createElement('textarea');
          t.value = url; document.body.appendChild(t); t.select();
          document.execCommand('copy'); document.body.removeChild(t);
          btnCopy.textContent = 'Link copied!';
          setTimeout(()=> btnCopy.innerHTML = '<i class="fa-solid fa-link"></i> Copy link', 1200);
        }
      };
    }

    if (btnShare) {
      btnShare.onclick = async () => {
        if (navigator.share) {
          try { await navigator.share({ title: document.title, text: msg, url }); } catch {}
        } else {
          // No Web Share API — fall back to Facebook (best preview card)
          window.open(fbIntent, '_blank', 'noopener,noreferrer');
        }
      };
    }
  });
}


      ['change','click','input','popstate','hashchange'].forEach(evt=>{
        window.addEventListener(evt, ()=> setTimeout(updateSharebars, 50), true);
      });

      const sel = document.getElementById('comp-selected');
      if (sel && 'MutationObserver' in window) {
        new MutationObserver(()=> setTimeout(updateSharebars, 10)).observe(sel, { childList:true, subtree:true, characterData:true });
      }

      window.addEventListener('load', ()=> setTimeout(updateSharebars, 100));

      // Back to top button logic
(function(){
  const btn = document.getElementById('scroll-top-btn');
  if (!btn) return;

  btn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Show button only when Date panel is active
  const datePanel = document.getElementById('by-date');
  const observer = new MutationObserver(() => {
    const visible = getComputedStyle(datePanel).display !== 'none';
    btn.style.display = visible ? 'inline-flex' : 'none';
  });
  observer.observe(datePanel, { attributes: true, attributeFilter: ['style'] });
})();



      
    })();

  </script>
  <!-- LGH Share Card Overlay (hidden; shown only with ?share=1) -->
<div id="sharecard-overlay" hidden>
  <div class="sc-modal">
    <div class="sc-modal-hd">
      <h3>Create Share Image</h3>
      <button type="button" class="sc-x" aria-label="Close">×</button>
    </div>

    <form id="sc-form">
      <div class="sc-row">
        <label>What</label>
        <select name="mode">
          <option value="fixtures">Fixtures</option>
          <option value="results">Results</option>
          <option value="table">Table / Standings</option>
        </select>
      </div>

      <div class="sc-row">
        <label>Date</label>
        <select name="preset">
          <option value="all">All</option>
          <option value="today">Today</option>
          <option value="tomorrow">Tomorrow</option>
        </select>
      </div>

      <div class="sc-row">
        <label>Club (optional)</label>
        <input type="text" name="team" placeholder="e.g., Na Piarsaigh" />
      </div>

      <div class="sc-row">
        <label>Rows (optional)</label>
        <input type="text" name="rows" placeholder="e.g., 3-7 for a mid-list slice" />
      </div>

      <div class="sc-row">
        <label>Size</label>
        <select name="size">
          <option value="ig-portrait">Instagram Portrait (1080×1350)</option>
          <option value="ig-square">Instagram Square (1080×1080)</option>
          <option value="x-landscape">X / Twitter (1200×675)</option>
        </select>
      </div>

      <div class="sc-row">
        <label>Title (optional)</label>
        <input type="text" name="title" placeholder="Auto-filled from your selection" />
      </div>

      <div class="sc-actions">
        <button type="button" id="sc-preview">Preview</button>
        <button type="button" id="sc-download" disabled>Download PNG</button>
        <button type="button" id="sc-copycap" disabled>Copy caption</button>
      </div>
    </form>

    <!-- Live preview (this is what becomes the PNG) -->
    <div id="share-card" class="sharecard sc-size-ig-portrait" hidden>
      <div class="sc-ribbon" id="sc-ribbon" hidden>Fixtures</div>
      <div class="sc-header">
        <!-- Use your crest — you can swap src to /img/crest.svg if you prefer -->
        <img src="/android-chrome-512x512.png" alt="" class="sc-crest">
        <div class="sc-title" id="sc-title">Senior • Group 1</div>
      </div>

      <!-- Fixtures/Results table -->
      <table class="sc-table sc-fixtures" id="sc-table-fixtures">
        <thead>
          <tr><th>Date/Time</th><th>Match</th><th>Venue</th></tr>
        </thead>
        <tbody id="sc-tbody"></tbody>
      </table>


    <!-- Standings table (PD included for share cards) -->
    <table class="sc-table sc-table-standings" id="sc-table-standings" hidden>
      <thead>
        <tr><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>PD</th><th>Pts</th></tr>
      </thead>
      <tbody id="sc-standings-body"></tbody>
    </table>

      <div class="sc-footnote" id="sc-footnote" hidden>
        Tie-breaks: Qualification: Head-to-Head (two teams only), then Points Difference, Points For, Goals For. Relegation: Playoff if two teams on equal points.
      </div>

      <div class="sc-footer">Limerick club fixtures, results, and tables at limerickgaahub.ie</div>
    </div>
  </div>
</div>


<!-- LGH Share Card logic (self-contained; runs only when ?share=1) -->
<script>
(function(){
  // Robust gate: honor either ?share=1 or ?sc=1, OR the early-captured flag
  const SHARE_ENABLED = (window.__LGH_SHARE_ENABLED === true);
  if (!SHARE_ENABLED) return;

  const params = new URLSearchParams(location.search);

  console.log('[LGH] Share Card enabled:', SHARE_ENABLED, location.search);
 
  // Helpers
  const q = sel => document.querySelector(sel);
  const qa = sel => Array.from(document.querySelectorAll(sel));

  
  // Share Card footer copy
  const SC_FOOTER_TEXT = 'Limerick club fixtures, results, and tables at limerickgaahub.ie';
  function setShareFooterText(){
    const el = q('.sc-footer');
    if (el) el.textContent = SC_FOOTER_TEXT;
}


  // --- stacked Date/Time formatting (match site mobile) ---
  const day3 = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const pad2 = n => String(n).padStart(2,'0');
  function fmtDateParts(dt){
    if(!dt || isNaN(+dt)) return {day:'', dmy:'', time:''};
    return {
      day:  day3[dt.getDay()],
      dmy:  `${pad2(dt.getDate())}/${pad2(dt.getMonth()+1)}`,
      time: '' // we'll keep time from raw string below
    };
  }
  function fmtTimeShort(t){
    if(!t) return '';
    const m = String(t).match(/^(\d{1,2}):(\d{2})/);
    return m ? `${pad2(m[1])}:${m[2]}` : t;
  }

  
  const isResult = (s) => ['Result','Full Time','FT','AET','Walkover','W/O','Abandoned','Final'].includes(String(s||'').trim());

    function labelOf(full){
      const dn = (window.LGH?.DISPLAY_NAMES || {})[full] || null;
      return dn?.label || full || '';
    }

    function isKOrow(r){
      return String(r.group||'').toLowerCase()==='knockout' || String(r.stage||'').toLowerCase()==='knockout';
    }

  
  function parseMatchDate(m){
    const s = m.date_iso || m.iso || m.datetime_iso || null;
    if (s) { const d = new Date(s); if (!isNaN(d)) return d; }
    const m2 = /(\d{1,2})\/(\d{1,2})\/(\d{2,4})/.exec(m.date||'');
    if (m2){ const dd=+m2[1], mm=+m2[2], yy=(m2[3].length===2? +('20'+m2[3]) : +m2[3]); return new Date(yy, mm-1, dd); }
    return null;
  }
  function inPreset(dt, preset){
    if(!dt) return true;
    const z = d=>{const x=new Date(d); x.setHours(0,0,0,0); return x;};
    const today = z(new Date());
    if (preset==='today')    return dt >= today && dt < new Date(+today + 86400000);
    if (preset==='tomorrow'){ const t=new Date(+today + 86400000); return dt >= t && dt < new Date(+t + 86400000); }
    return true; // 'all'
  }

  function compName(code){
    return (window.REVERSE_CODES && window.REVERSE_CODES[code]) || code || '';
  }


// String "1-18" → {g:1, p:18}
function gpFromScoreStr(s){
  const m = String(s||'').match(/^\s*(\d+)\s*-\s*(\d+)\s*$/);
  return m ? { g: +m[1], p: +m[2] } : { g: null, p: null };
}
function pointsFromGP(g,p){
  if (g==null || p==null) return null;
  return (Number(g)||0)*3 + (Number(p)||0);
}

// --- H2H + PD helpers (share-card scope) ---
function _readTotals(m, side){ // returns {total, goals}
  // Prefer split fields, else parse "1-18" strings in home_score/away_score
  let g = (side==='home') ? m.home_goals : m.away_goals;
  let p = (side==='home') ? m.home_points : m.away_points;
  if (g==null || p==null){
    const src = (side==='home') ? (m.home_score || m.home || '') : (m.away_score || m.away || '');
    const mm = String(src||'').match(/^\s*(\d+)\s*-\s*(\d+)\s*$/);
    if (mm){ g = +mm[1]; p = +mm[2]; }
  }
  const total = pointsFromGP(g, p);
  return { total: Number(total||0), goals: Number(g||0) };
}

function _winnerOfRow(m){
  const hs = _readTotals(m,'home'), as = _readTotals(m,'away');
  if (hs.total > as.total) return m.home;
  if (as.total > hs.total) return m.away;
  return null;
}

function _h2hCompareShare(a, b, results){
  // Single prior scored meeting in this comp/group (exclude walkovers)
  const games = results.filter(m =>
    ((m.home===a.team && m.away===b.team) || (m.home===b.team && m.away===a.team)) &&
    isResult(m.status)   // only proper scored results
  );
  if (games.length === 1){
    const w = _winnerOfRow(games[0]);
    if (w === a.team) return -1;
    if (w === b.team) return  1;
  }
  return 0;
}

function _comparePD_PF_GF(a, b){
  const pdA = (a.pf||0) - (a.pa||0);
  const pdB = (b.pf||0) - (b.pa||0);
  if (pdA !== pdB) return pdB - pdA;               // PD
  if ((a.pf||0) !== (b.pf||0)) return b.pf - a.pf;  // Points For
  if ((a.gf||0) !== (b.gf||0)) return b.gf - a.gf;  // Goals For
  return a.team.localeCompare(b.team);
}

function computeStandings(rows){
  const isRes = (window.LGH?.isResult) || isResult;

  // Seed teams
  const teams = new Map();
  for (const r of rows){
    if (!teams.has(r.home)) teams.set(r.home,{team:r.home,p:0,w:0,d:0,l:0,pf:0,pa:0,gf:0,ga:0,pts:0});
    if (!teams.has(r.away)) teams.set(r.away,{team:r.away,p:0,w:0,d:0,l:0,pf:0,pa:0,gf:0,ga:0,pts:0});
  }

  // Results only (incl. walkover handling)
  const results = rows.filter(r => isRes(r.status));

  for (const m of results){
    const H = teams.get(m.home), A = teams.get(m.away);

    // Walkover: played + 2 pts to winner; no PF/PA
    if (/^walkover$/i.test(String(m.status||''))){
      H.p++; A.p++;
      const w = (m.walkover_winner||'').toLowerCase();
      if (w==='home'){ H.w++; H.pts+=2; A.l++; }
      else if (w==='away'){ A.w++; A.pts+=2; H.l++; }
      continue;
    }

    const hs = _readTotals(m,'home');
    const as = _readTotals(m,'away');

    H.p++; A.p++;
    H.pf += hs.total; H.pa += as.total; H.gf += hs.goals; H.ga += as.goals;
    A.pf += as.total; A.pa += hs.total; A.gf += as.goals; A.ga += hs.goals;

    if (hs.total > as.total){ H.w++; H.pts+=2; A.l++; }
    else if (as.total > hs.total){ A.w++; A.pts+=2; H.l++; }
    else { H.d++; A.d++; H.pts++; A.pts++; }
  }

  // Group by points to apply H2H when EXACTLY two are tied
  const all = Array.from(teams.values());
  const byPts = new Map();
  for (const t of all){
    if (!byPts.has(t.pts)) byPts.set(t.pts, []);
    byPts.get(t.pts).push(t);
  }

  const sorted = []
    .concat(...[...byPts.keys()].sort((a,b)=>b-a).map(pts=>{
      const bucket = byPts.get(pts);
      if (bucket.length === 2){
        bucket.sort((a,b)=>{
          const h2h = _h2hCompareShare(a, b, results);
          if (h2h !== 0) return h2h;
          return _comparePD_PF_GF(a,b);
        });
        return bucket;
      }
      bucket.sort(_comparePD_PF_GF);
      return bucket;
    }));

  return sorted;
}




function buildPayload({mode,preset,team,rowsRange,size,title}){
  const comp  = window.LGH?.state?.comp  || '';
  const group = window.LGH?.state?.group || '';
  const meta  = (window.LGH?.DISPLAY_NAMES || {})[comp] || {};
  const isRes = (window.LGH?.isResult || isResult);

  // Start with matches for this competition
  let rows = (window.LGH?.matches || []).filter(r => r.competition === comp);

  // League vs Knockout
  if (group === 'Knockout') {
    rows = rows.filter(isKOrow);
  } else {
    rows = rows.filter(r => !isKOrow(r));
    if (!meta.pihc && group) rows = rows.filter(r => (r.group||'') === group);
  }

  // Club filter
  if (team) rows = rows.filter(r => r.home===team || r.away===team);

  // Fixtures vs Results (exactly once)
  if (mode === 'fixtures') rows = rows.filter(r => !isRes(r.status));
  if (mode === 'results')  rows = rows.filter(r =>  isRes(r.status));

  // Date preset
  if (preset && preset !== 'all'){
    rows = rows.filter(r => inPreset(parseMatchDate(r), preset));
  }

  // Slice
  if (rowsRange){
    const m = /^\s*(\d+)\s*-\s*(\d+)\s*$/.exec(rowsRange);
    if (m){ const a=+m[1], b=+m[2]; rows = rows.slice(a-1, b); }
  }

  // Title
  const bits = [labelOf(comp)];
  if (group && !meta.pihc) bits.push(group);
  if (rows.length && rows[0].round) bits.push(rows[0].round);
  if (team) bits.push(team);
  if (preset==='today')    bits.push('Today');
  if (preset==='tomorrow') bits.push('Tomorrow');

  return { mode, size, title: (title?.trim() || bits.filter(Boolean).join(' • ')), rows };
}


function scoreMid(m){
  const s = String(m.status||'').toLowerCase();
  if (s === 'walkover') return 'W/O';

  // Accept split fields OR "1-18" strings
  const asPair = str => {
    const mm = String(str||'').match(/^\s*(\d+)\s*-\s*(\d+)\s*$/);
    return mm ? {g:+mm[1], p:+mm[2]} : {g:null, p:null};
  };

  let hg = m.home_goals, hp = m.home_points, ag = m.away_goals, ap = m.away_points;
  if (hg==null || hp==null){ const a = asPair(m.home_score); hg = a.g; hp = a.p; }
  if (ag==null || ap==null){ const b = asPair(m.away_score); ag = b.g; ap = b.p; }

  if ([hg,hp,ag,ap].some(v => v==null || v==='')) return '—';
  return `${hg}-${hp} – ${ag}-${ap}`;
}


function matchCellHTML(m, mode){
  const mid   = (mode === 'results') ? scoreMid(m) : 'v';
  const mCls  = (mode === 'results') ? 'sc-match-mid sc-score' : 'sc-match-mid';
  return `
    <div class="sc-match">
      <div class="sc-match-team">${m.home}</div>
      <div class="${mCls}">${mid}</div>
      <div class="sc-match-team">${m.away}</div>
    </div>`;
}


function renderCard(payload){
  const card = q('#share-card');

  // Reset size + density classes
  card.classList.remove(
    'sc-size-ig-portrait','sc-size-ig-square','sc-size-x-landscape',
    'sc-tight-7','sc-tight-8','sc-hero'
  );
  card.classList.add(
    payload.size === 'ig-square'    ? 'sc-size-ig-square' :
    payload.size === 'x-landscape'  ? 'sc-size-x-landscape' :
                                      'sc-size-ig-portrait'
  );

  // Mode class for spacing tweaks (fixtures/results vs table)
  card.classList.remove('sc-mode-fixtures','sc-mode-results','sc-mode-table');
  card.classList.add(
    payload.mode === 'results' ? 'sc-mode-results' :
    payload.mode === 'table'   ? 'sc-mode-table'   : 'sc-mode-fixtures'
  );

  
  q('#sc-title').textContent = payload.title || '';
  // --- Corner ribbon text & show ---
(function(){
  const rib = q('#sc-ribbon');
  if (!rib) return;

  const modeWord =
    payload.mode === 'results' ? 'Results' :
    payload.mode === 'table'   ? 'Table'   : 'Fixtures';

  // Try to surface "Today" / "Tomorrow" if present in the title
  const m = /\b(Today|Tomorrow)\b/i.exec(payload.title || '');
  const when = m ? m[1] : '';

  rib.textContent = when ? `${modeWord} • ${when}` : modeWord;
  rib.hidden = false;
})();

  const tb = q('#sc-tbody');
  const tf = q('#sc-table-fixtures');
  const st = q('#sc-table-standings');
  const sb = q('#sc-standings-body');

  if (payload.mode === 'table') {
    // Standings view
    tf.hidden = true;
    st.hidden = false;

const standings = computeStandings(payload.rows);
sb.innerHTML = standings.map(t => `
  <tr>
    <td>${t.team}</td>
    <td>${t.p}</td><td>${t.w}</td><td>${t.d}</td><td>${t.l}</td>
    <td>${(t.pf||0)-(t.pa||0)}</td>
    <td>${t.pts}</td>
  </tr>
`).join('');

// Apply density based on actual count
const rowCount = standings.length;
if (rowCount === 6) card.classList.add('sc-tight-6');
if (rowCount === 7) card.classList.add('sc-tight-7');
if (rowCount >= 8)  card.classList.add('sc-tight-8');


// Show footnote for table mode
q('#sc-footnote').hidden = false;

} else {
  // Fixtures / Results view
  q('#sc-footnote').hidden = true;  // hide footnote on fixtures/results
  st.hidden = true;
  tf.hidden = false;

  tb.innerHTML = payload.rows.map(m => {
    const dt = parseMatchDate(m) || (m.date ? new Date(m.date + 'T00:00:00') : null);
    const p  = fmtDateParts(dt);
    const t  = fmtTimeShort(m.time || '');
    const mid = matchCellHTML(m, payload.mode);   // Team A / mid / Team B
    return `
      <tr>
        <td>
          <div class="dt3">
          ${m.round ? `<div class="dt-round">${m.round}</div>` : ''}
            <div class="dt-day">${p.day}</div>
            <div class="dt-date">${p.dmy}</div>
            <div class="dt-time">${t}</div>
          </div>
        </td>
        <td>${mid}</td>
        <td>${m.venue || '—'}</td>
      </tr>`;
  }).join('');


    const rowCount = payload.rows.length;
    if (rowCount <= 2) card.classList.add('sc-hero');   // make 1–2 matches feel less bare
  }

  card.hidden = false;
  q('#sc-download').disabled = !(window.__LGH_H2C_READY === true);
  q('#sc-copycap').disabled = false;

  // Ensure footer text matches your constant
  setShareFooterText();
}


  async function downloadPNG(){
    if (typeof html2canvas !== 'function') {
      alert('Share image engine is still loading. Try again in a second.');
      return;
    }
    const src = q('#share-card');
  
    // Clone outside the scrollable modal so nothing is clipped
    const clone = src.cloneNode(true);
    clone.id = 'share-card-clone';
    clone.hidden = false;
    clone.style.position = 'fixed';
    clone.style.left = '-10000px';
    clone.style.top  = '0';
    document.body.appendChild(clone);
  
    try{
      const SCALE = Math.min(Math.max(window.devicePixelRatio || 2, 2), 3);
      const canvas = await html2canvas(clone, {
      scale: SCALE,
      backgroundColor: null,
      useCORS: true,
      removeContainer: true
    });

      
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = 'lgh-card.png';
      a.click();
    } finally {
      document.body.removeChild(clone);
    }
  }


  function makeCaption(payload){
    const modeWord = payload.mode==='fixtures' ? 'fixtures' :
                     payload.mode==='results' ? 'results' : 'table';
    return `${payload.title} ${modeWord}. More: limerickgaahub.ie`;
  }

  function injectButtons(){
    qa('.sharebar').forEach(bar=>{
      if(bar.querySelector('.lgh-sc-btn')) return;
      const btn = document.createElement('button');
      btn.className = 'lgh-sc-btn';
      btn.type = 'button';
      btn.textContent = 'Create Share Image';
      btn.addEventListener('click', openOverlay);
      bar.appendChild(btn);
    });
  }

  function openOverlay(){ q('#sharecard-overlay').hidden = false; }
  function closeOverlay(){ q('#sharecard-overlay').hidden = true; }

  function wireOverlay(){
    const overlay = q('#sharecard-overlay');
    const form = q('#sc-form');
    q('.sc-x').addEventListener('click', closeOverlay);
    overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeOverlay(); });

    q('#sc-preview').addEventListener('click', ()=>{
      const payload = buildPayload({
        mode: form.mode.value,
        preset: form.preset.value,
        team: (form.team.value||'').trim() || null,
        rowsRange: (form.rows.value||'').trim() || null,
        size: form.size.value,
        title: form.title.value
      });
      renderCard(payload);
      overlay._lastPayload = payload;
    });

    q('#sc-download').addEventListener('click', downloadPNG);

    q('#sc-copycap').addEventListener('click', ()=>{
      const payload = overlay._lastPayload || {title:'', mode:'fixtures'};
      const text = makeCaption(payload);
      navigator.clipboard.writeText(text).catch(()=>{});
    });

      // Deep-link presets ?share=1&mode=...
      if(params.get('share') === '1'){
      openOverlay();
      if(params.get('mode')) form.mode.value = params.get('mode');
      if(params.get('preset')) form.preset.value = params.get('preset');
      if(params.get('team')) form.team.value = params.get('team');
      if(params.get('rows')) form.rows.value = params.get('rows');
      if(params.get('size')) form.size.value = params.get('size');
      if(params.get('title')) form.title.value = params.get('title');
      q('#sc-preview').click();
    }
  }

window.addEventListener('load', ()=>{
  setTimeout(()=>{
    injectButtons();
    wireOverlay();
    setShareFooterText(); // set footer once on load
  }, 250);
});
})();
</script>
</body>
</html>
